- **발표 자료 :** [B208_STA:D_최종발표.pptx](STAD_최종발표.pptx)
- **최종 발표 : 24년 05월 20일**
- **발표자 : 이태경**

### 목차

1. 기획 배경
2. 서비스 소개
3. 시연
4. 아키텍처 & 기술 활용
5. QnA

FAST와 Mobile을 연결한 크로스 디바이스 서비스

---

### 기획 배경

여러분의 스마트폰은 지금 어디있나요?
아마 여러분의 1m 내에 존재할 것입니다. 우리는 이 작은 기기를 통해서 가장 쉽게 인터넷에 접근합니다. 스마트폰을 비롯한 모바일 기기들은 이 특징을 활용해 IoT의 시대에서 모든 사물에 닿을 수 있는 리모컨의 기능을 하게 되었습니다. 기존의 흩어진 디바이스들의 정보를 이 모바일 기기에 모으고 활용하는 것. 그것이 IoT의 초입에서 모든 기업이 집중하고 있는 관심사일 것입니다.

우리는 이 흐름에서 스마트폰을 어떤 기기와 연결할 것인지 고민을 했고, 한국의 가구의 95.4%가 가지고있는 필수가전에 연결하기로 했습니다. 바로 TV입니다.

우리는 TV를 스마트폰에 연동하여 사용자가 TV의 정보를 스마트폰에서 확인하고 쉽게 활용할 수 있도록 크로스 디바이스 서비스를 만드는 것을 기획했다.


우리는 이 프로젝트에서 FAST서비스와  Moblie을 연동하고자 합니다.
FAST(Free Advertising Streaming TV) 서비스는 새로운 차세대 케이블로 불리는 서비스로 구독료를 받지 않고 광고를 시청하여 무료로 컨텐츠를 이용할 수 있는 미디어 서비스입니다. FAST는 삼성, LG 등의 기업도 참여하고 있으며, 그 시장규모가 더욱 성장할 것으로 예상되고 있습니다.

우리는 FAST서비스의 개인 맞춤광고를 mobile과 연결했을때 얻어지는 시너지가 어떤 것이 있을지 생각해보았습니다.

사용자는 맞춤 광고를 mobile에서 확인하여 정보를 확인하고 쉽게 구매로 이어지는 새로운 고객경험을 얻을 수 있을 것이며,

FAST 서비스 제공 기업에서는 광고비가 가장 큰 비중을 차지했던 기존의 BM에서 쇼핑 서비스를 통한 판매 수수료라는 수입원을 더해 BM의 다각화를 이루고 사업의 안정성을 더할 수 있을 것이라 생각했습니다.

우리는 FAST의 개인 맞춤형 광고를 Mobile에 연동하여 쉽게 구매까지 가능한 서비스를 개발했고,
FAST와 AD를 합쳐 STA:D (스태디)로 이름 지었습니다.


---

### 서비스 소개

STA:D의 서비스는 크게 세부분으로 나누어져 있습니다.

1. FAST 서비스의 Streaming TV 파트

   streaming TV에서는 VOD형식으로 전달되는 컨텐츠와 AI model을 사용한 개인형 맞춤 광고를 송출합니다.

2. FAST 서비스의 정보를 Mobile로 확인하고 활용할 수 있는 APP 파트

app에서는 컨텐츠가 시청하지 않을때는 인기 컨텐츠와 광고의 정보를,
컨텐츠 시청를 시청할 때는 시청 중 컨텐츠 정보와 현재 시청 중인 광고의 정보를 보여주고
광고 배너를 클릭해 상품 구매 페이지로 이동하여 결제까지 가능한 기능을 갖추고 있습니다.
3. FAST에 광고를 제공하는 기업 사용자를 위한 광고 관리 Web 파트

기업 웹사이트에서는 기업이 FAST서비스를 통해 사용자에게 제공할 광고와 상품의 등록과 관리가 가능하며, 사용자 데이터를 통해 해당 기업의 광고와 상품의 판매에 관련된 통계를 확인해 볼 수 있습니다.


---

### 시연

- 기업 WEB

  광고 create

  물먹는 하마 광고 등록 (미리 준비)

  select  content를 지정해 광고를 넣을 수 있음을 보여줌

  (이후 해당 컨텐츠에서 광고가 나오는 것을 확인)(늑대의 유혹 → 물먹는 하마 광고 삽입)

  상품 create

  물먹는 하마 상품 등록 (미리 준비)

  상품 등록 현황 확인

  상품 통계 확인

- TV & APP

  (TV와 APP을 플립과 스크린을 통해 보여줌)

  APP 로그인

  APP에서 Google login

  QR 로그인

  TV에서 QR 로그인을 누른 후 APP에서 QR코드 스캔을 진행

  APP 인기 컨텐츠 재생 요청 (어벤저스)

  APP & TV 광고 재생

  APP & TV 컨텐츠 재생

  TV 검색을 통하여 늑대의 유혹 재생

  물먹는 하마 광고 확인
  APP 광고 배너 클릭
  장바구니 확인

  장바구니 품목 결제

---

### 아키텍처 & 기술 활용

MSA 아키텍처 설계

- 각각의 기능을 담당하는 서버가 독립적으로 존재해 안정성, 확장성을 확보할 수 있었습니다.

Kafka

- 서버간 통신에 kafka를 사용해 비동기적 통신을 적용해 확장성과 안정성, 독립성, 유연성을 얻을 수 있었습니다.

### 주요기술 설명

### streaming 기능

- 버퍼링이 없이 대용량의 동영상 파일을 전송하기 위해서는 S3에 업로드 되어있는 동영상을 작은 단위로 쪼개 클라이언트에 전송해야 했습니다.
  이를 위하여 UrlResource 클래스로 비디오 자원에 접근하고 **ResourceRegion 클래스와 HttpRange 클래스를 사용하여 요청한 비디오 파일의 구간 정보를 담은 객체를 보내는** 기능을 구현했습니다. 이러한 기능을 하는Streaming 서버를 두었고, 클라이언트는 대용량 비디오 파일을 효율적으로 수신할 수 있습니다.
- 테스팅 & 트러블 슈팅
  테스팅 과정에서 다수 사용자가 동시에 동영상을 재생할 때 **심한 버퍼링**이 생기는 것을 파악하고 이를 개선해야 했습니다. 우리가 선택한 방법은 두가지로
- Redis
  - 다운로드할 url 조회 과정에서 일어나는 DB connection을 Cache를 이용해 줄일 수 있었고, 100%의 성능개선을 이룰 수 있었었습니다.
- prefetch
  - 대용량의 컨텐츠 동영상을 광고 재생 시간에 미리 다운을 받아 여유분을 확보하는 방법으로 버퍼링을 최소화 할 수 있었습니다.

### 맞춤형 광고 제공 기능

- 맞춤형 광고를 제공하기 위해서 사용자의 정보를 적절히 채택하고 활용해야할 필요가 있었습니다.
  - 전처리된 텍스트에서 추출한 단어를 벡터화하고 단어 **벡터간 유의미한 유사도를 반영할 수 있도록 word2vector 모델**을 사용하였습니다.
  - 또한 이전 입력 데이터를 기억해 다음 출력값을 결정하는 모델인 **RNN 중에서도 긴 텍스트 처리에 용이한 LSTM 모델을 활용**하여 카테고리 분류를 구현하였습니다.
  - 가입 시 사용자의 youtube 구독채널 정보를 활용하여 유저 관심사를 STA:D의 231 개의 카테고리 중 가장 cos 유사도가 높은 카테고리를 찾아냈고, 이를 기반으로 User AdQueue를 만들어 맞춤형 광고를 제공함
  - 이후에 STA:D에서 시청한 영상기록을 기반으로 유저 관심사를 도출하고 이를 기반으로 User AdQueue를 만들어 맞춤형 광고를 제공함

### 통계 데이터 산출 기능

- 기업고객에게 제공하는 게시 광고와 판매 제품에 대한 통계데이터를 제공하기 위해서 SpringBatch를 활용했습니다.
  - 사용자 활동 log를 stats 서버의 DB에 저장하고 이를 한시간마다 조회해 통계 데이터를 만드는 작업을 spring batch를 활용해 진행했으며 이를 이용해 통계 데이터 산출시 16000% 성능개선을 이룰 수 있었습니다.


### 크로스 디바이스 기능

- SSE connect 정보를 connect서버에 저장하고 이를 활용하여 양쪽으로 Event을 송신하는 방식으로 디바이스간 정보를 공유하는 크로스디바이스 기능을 구현했습니다.

### 결제 API

- 문제점
  - 여러 개의 PG사와 결제 수단을 이용하고 싶었음
  - 사업자 등록을 진행할 수 없어, 결제 후 환불까지 자동으로 이루어지는 테스트 환경이 필요했음
- 해결 방안
  - 포트원 API를 통해 다양한 PG사와 결제 수단을 도입할 수 있었음
  - 테스트 환경으로 사업자 번호가 없어도 실제 결제가 진행되고 자동으로 환불 할 수 있었음